# Bug Fix: 双击视频全屏不显示字幕

**日期**: 2026-01-21
**版本**: v0.0.11
**严重程度**: 中等

## 问题描述

用户双击视频进入全屏模式时，字幕不显示。而通过点击右上角自定义全屏按钮进入全屏时，字幕正常显示。

### 症状
1. 双击视频 → 进入原生视频全屏 → 字幕消失
2. 双击退出全屏后 → 字幕仍不显示
3. 点击自定义全屏按钮 → 进入 wrapper 全屏 → 字幕正常

## 根本原因

浏览器原生的 `<video>` 元素有默认的双击全屏行为，会使视频元素本身进入全屏模式（`video.requestFullscreen()`），而不是包含字幕覆盖层的父容器（`playerWrapperRef`）。

之前的实现：
```tsx
<video
  onDoubleClick={(e) => {
    e.preventDefault();
    togglePlayerFullscreen();
  }}
/>
```

问题：`e.preventDefault()` 无法阻止浏览器原生的视频双击全屏行为，因为这是浏览器层面的默认处理。

## 解决方案

添加透明覆盖层拦截双击事件，阻止事件传递到原生视频元素：

### 1. App.tsx 修改

移除视频元素的 `onDoubleClick`，添加独立的点击拦截层：

```tsx
{/* Double-click overlay to intercept clicks and trigger custom fullscreen */}
<div
  className="video-click-overlay"
  onDoubleClick={(e) => {
    e.preventDefault();
    e.stopPropagation();
    togglePlayerFullscreen();
  }}
  onClick={(e) => {
    // Single click toggles play/pause
    if (videoRef.current) {
      if (videoRef.current.paused) {
        videoRef.current.play();
      } else {
        videoRef.current.pause();
      }
    }
  }}
/>
```

### 2. App.css 修改

添加覆盖层样式：

```css
/* Transparent overlay to capture double-click for custom fullscreen */
.video-click-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(100% - 40px); /* Leave space for video controls at bottom */
  z-index: 5; /* Above video but below controls, subtitles, and buttons */
  cursor: pointer;
}
```

## 技术细节

### 层级结构（z-index）
- Video: 基础层
- `.video-click-overlay`: z-index: 5（拦截双击）
- `.custom-fullscreen-btn`: z-index: 100（全屏按钮）
- `SubtitleOverlay`: z-index: 10+（字幕显示）

### 为什么留出底部 40px？
- 允许用户访问原生视频控制条（播放、音量、进度条等）
- 覆盖层只拦截视频主体区域的点击

## 影响的文件

| 文件 | 修改类型 |
|------|----------|
| `src/App.tsx` | 添加 `.video-click-overlay` div，移除视频的 onDoubleClick |
| `src/App.css` | 添加 `.video-click-overlay` 样式 |

## 测试验证

1. [x] 双击视频主体区域 → 进入 wrapper 全屏，字幕正常显示
2. [x] 双击全屏下再次双击 → 退出全屏，字幕正常显示
3. [x] 单击视频 → 播放/暂停切换正常
4. [x] 点击自定义全屏按钮 → 功能正常
5. [x] 底部视频控制条 → 可正常点击操作
